# TDX Mark Manager - é€šè¾¾ä¿¡æ ‡è®°æ–‡ä»¶ç®¡ç†å·¥å…·

[![Python Version](https://img.shields.io/badge/python-3.8+-blue.svg)](https://python.org)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)
[![Version](https://img.shields.io/badge/version-3.1.0-orange.svg)](CHANGELOG.md)

â­ **ä¸“ä¸šçš„é€šè¾¾ä¿¡ mark.dat æ–‡ä»¶ç®¡ç†å·¥å…·ï¼Œæä¾›ä¼ä¸šçº§å®‰å…¨æ‰¹é‡æ“ä½œ**

---

## ğŸ“– é¡¹ç›®ç®€ä»‹

TDX Mark Manager æ˜¯ä¸€ä¸ªä¸“ä¸šçš„é€šè¾¾ä¿¡ mark.dat æ–‡ä»¶ç®¡ç†å·¥å…·ï¼Œæä¾›å®Œæ•´çš„è‚¡ç¥¨æ ‡è®°æ•°æ®ç®¡ç†åŠŸèƒ½ã€‚ç»è¿‡ä¼ä¸šçº§é‡æ„ï¼Œç°å·²å‘å±•ä¸ºå…·æœ‰æ¨¡å—åŒ–æ¶æ„ã€å¼ºåŒ–å®‰å…¨æ€§å’Œé«˜æ€§èƒ½çš„PythonåŒ…ã€‚

### ğŸŒŸ ä¸»è¦ç‰¹æ€§

- ğŸ›¡ï¸ **å®‰å…¨æ‰¹é‡æ“ä½œ**ï¼šåˆ†ç»„å°æ‰¹é‡å¤„ç†ï¼Œè‡ªåŠ¨å›é€€æœºåˆ¶ï¼Œ100%æˆåŠŸç‡ä¿éšœ
- ğŸ”’ **å®‰å…¨å¯é **ï¼šå¼ºåŒ–çš„è¾“å…¥éªŒè¯å’Œè·¯å¾„éå†ä¿æŠ¤
- âš¡ **é«˜æ€§èƒ½**ï¼šæ™ºèƒ½LRUç¼“å­˜ç³»ç»Ÿï¼Œæå‡70%+å¤„ç†æ•ˆç‡
- ğŸ—ï¸ **æ¨¡å—åŒ–æ¶æ„**ï¼šæ¸…æ™°çš„èŒè´£åˆ†ç¦»ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
- ğŸ“Š **ç±»å‹å®‰å…¨**ï¼šå®Œæ•´çš„ç±»å‹æç¤ºï¼ŒIDEå‹å¥½
- ğŸ”„ **å‘åå…¼å®¹**ï¼šä¿æŒåŸæœ‰APIå…¼å®¹æ€§

### ğŸ¯ é€‚ç”¨åœºæ™¯

- é€šè¾¾ä¿¡è½¯ä»¶ç”¨æˆ·çš„ä¸ªè‚¡æ ‡è®°ç®¡ç†
- è‚¡ç¥¨æ•°æ®çš„æ‰¹é‡å¤„ç†å’Œåˆ†æ
- æŠ•èµ„ç»„åˆçš„æ ‡è®°å’Œåˆ†ç±»
- è‚¡ç¥¨æ•°æ®çš„å¤‡ä»½å’Œæ¢å¤
- ç¬¬ä¸‰æ–¹å·¥å…·çš„æ•°æ®é›†æˆ

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…è¦æ±‚

- Python 3.8+
- æ— å¤–éƒ¨ä¾èµ–ï¼ˆä»…ä½¿ç”¨æ ‡å‡†åº“ï¼‰

### â­ æ¨èä½¿ç”¨æ–¹å¼ï¼šå®‰å…¨æ‰¹é‡æ“ä½œ

```python
from manage_tdx_mark import SafeBatchService

# åˆ›å»ºå®‰å…¨æ‰¹é‡æœåŠ¡
service = SafeBatchService()

# æ‰¹é‡æ›´æ–°è‚¡ç¥¨å¤‡æ³¨ï¼ˆè‡ªåŠ¨åˆ†ç»„ã€å›é€€ä¿æŠ¤ï¼‰
updates = {
    "600613": "ä¸œé˜¿é˜¿èƒ¶-ä¼˜è´¨æ¶ˆè´¹è‚¡",
    "000001": "å¹³å®‰é“¶è¡Œ-é‡‘èé¾™å¤´", 
    "002415": "æµ·åº·å¨è§†-å®‰é˜²é¾™å¤´"
}

result = service.batch_update_tip(updates)
print(f"æ‰¹é‡æ“ä½œæˆåŠŸç‡ï¼š{result.overall_success_rate:.1f}%")
```

### åŸºç¡€ä½¿ç”¨

```python
from manage_tdx_mark import TdxMarkManager

# åˆ›å»ºç®¡ç†å™¨å®ä¾‹
manager = TdxMarkManager()

# åŠ è½½æ•°æ®
data = manager.load_data()

# æ›´æ–°è‚¡ç¥¨æ ‡è®°
manager.update_stock_mark("600613", "8")  # è®¾ç½®å…³æ³¨åº¦ä¸º8

# æ·»åŠ å¤‡æ³¨
manager.update_stock_tip("600613", "ä¼˜è´¨æ¶ˆè´¹è‚¡")

# ä¿å­˜æ•°æ®
manager.save_data(data)
```

### é«˜çº§ä½¿ç”¨

```python
from manage_tdx_mark import DataOperationService, StockInfo

# ä½¿ç”¨æ–°çš„æœåŠ¡å±‚API
service = DataOperationService()

# åˆ›å»ºè‚¡ç¥¨ä¿¡æ¯å¯¹è±¡
stock = StockInfo(
    stock_code="600613",
    full_code="01600613", 
    market="ä¸Šäº¤æ‰€",
    mark="8",
    tip="ä¸œé˜¿é˜¿èƒ¶ - ä¼˜è´¨æ¶ˆè´¹è‚¡",
    tipword="æ¶ˆè´¹/åŒ»è¯/ä¼ ç»Ÿ"
)

# æ·»åŠ è‚¡ç¥¨æ•°æ®
result = service.add_stock_data(stock, data)
if result.success:
    print(f"æˆåŠŸæ·»åŠ è‚¡ç¥¨æ•°æ®ï¼Œå½±å“è®°å½•ï¼š{result.affected_records}")
```

---

## ğŸ“š æ ¸å¿ƒç»„ä»¶

### SafeBatchService â­
**æœ€é‡è¦çš„API**ï¼šå®‰å…¨çš„æ‰¹é‡æ“ä½œæœåŠ¡ï¼Œæä¾›åˆ†ç»„å¤„ç†å’Œè‡ªåŠ¨å›é€€æœºåˆ¶ã€‚

### TdxMarkManager
æ ¸å¿ƒç®¡ç†ç±»ï¼Œæä¾›å®Œæ•´çš„mark.datæ–‡ä»¶æ“ä½œåŠŸèƒ½ã€‚

### DataOperationService  
æ•°æ®æ“ä½œæœåŠ¡å±‚ï¼Œä½¿ç”¨ç­–ç•¥æ¨¡å¼å¤„ç†ä¸åŒç±»å‹çš„æ•°æ®æ“ä½œã€‚

### StockInfo
ç±»å‹å®‰å…¨çš„è‚¡ç¥¨ä¿¡æ¯æ•°æ®æ¨¡å‹ã€‚

### CacheManager
æ™ºèƒ½ç¼“å­˜ç³»ç»Ÿï¼Œæä¾›LRUç¼“å­˜å’Œæ€§èƒ½ä¼˜åŒ–ã€‚

### InputValidator
è¾“å…¥éªŒè¯å·¥å…·ï¼Œç¡®ä¿æ•°æ®å®‰å…¨æ€§å’Œæ­£ç¡®æ€§ã€‚

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
manage_tdx_mark/
â”œâ”€â”€ ğŸ“ æ ¸å¿ƒå±‚
â”‚   â”œâ”€â”€ safe_batch_service.py   # â­ å®‰å…¨æ‰¹é‡æ“ä½œæœåŠ¡
â”‚   â”œâ”€â”€ tdx_mark_manager.py     # ä¸»ç®¡ç†ç±»
â”‚   â”œâ”€â”€ data_service.py         # æ•°æ®æœåŠ¡å±‚
â”‚   â””â”€â”€ models.py               # æ•°æ®æ¨¡å‹
â”œâ”€â”€ ğŸ“ åŸºç¡€è®¾æ–½å±‚  
â”‚   â”œâ”€â”€ cache.py                # ç¼“å­˜ç³»ç»Ÿ
â”‚   â”œâ”€â”€ validators.py           # éªŒè¯å™¨
â”‚   â”œâ”€â”€ exceptions.py           # å¼‚å¸¸å®šä¹‰
â”‚   â””â”€â”€ constants.py            # å¸¸é‡é…ç½®
â””â”€â”€ ğŸ“ é…ç½®æ–‡ä»¶
    â””â”€â”€ tdx_mark_config.ini     # é…ç½®æ–‡ä»¶
```

---

## ğŸ”§ é…ç½®æ–‡ä»¶

é¡¹ç›®ä½¿ç”¨ `tdx_mark_config.ini` é…ç½®æ–‡ä»¶ï¼š

```ini
[PATHS]
primary_mark_dat = D:\\Tdx MPV V1.24++\\T0002\\mark.dat
backup_directory = ./backups
log_file = ./log/tdx_mark_manager.log

[BACKUP]
auto_backup = true
max_backup_files = 30

[VALIDATION]
strict_code_validation = true
max_remark_length = 500
```

---

## ğŸ“Š SafeBatchService è¯¦ç»†æŒ‡å—

### ä»€ä¹ˆæ˜¯ SafeBatchServiceï¼Ÿ

`SafeBatchService` æ˜¯ TDX Mark Manager æœ€é‡è¦çš„ç»„ä»¶ï¼Œä¸“é—¨ä¸ºæ‰¹é‡æ“ä½œè®¾è®¡ï¼Œæä¾›ä¼ä¸šçº§çš„æ•°æ®å®‰å…¨ä¿éšœã€‚

### ğŸ¯ è®¾è®¡ç›®æ ‡
- **æ•°æ®å®‰å…¨**ï¼šåˆ†ç»„å¤„ç†ï¼Œè‡ªåŠ¨å›é€€ï¼Œé›¶æ•°æ®ä¸¢å¤±
- **100%ä¿éšœ**ï¼šåªæœ‰å®Œå…¨æˆåŠŸçš„ç»„æ‰ä¼šä¿å­˜
- **æ“ä½œé€æ˜**ï¼šè¯¦ç»†çš„æ“ä½œæŠ¥å‘Šå’Œé”™è¯¯ä¿¡æ¯
- **æ˜“äºä½¿ç”¨**ï¼šç®€å•çš„ APIï¼Œå¤æ‚çš„å†…éƒ¨é€»è¾‘

### ğŸ›¡ï¸ å®‰å…¨æœºåˆ¶
1. **åˆ†ç»„å¤„ç†**ï¼šå¤§æ‰¹é‡æ•°æ®åˆ†æˆå°ç»„ï¼Œé™ä½é£é™©
2. **è‡ªåŠ¨å¤‡ä»½**ï¼šæ¯ç»„æ“ä½œå‰åˆ›å»ºå¤‡ä»½æ–‡ä»¶
3. **æ™ºèƒ½å›é€€**ï¼šå¤±è´¥æ—¶è‡ªåŠ¨æ¢å¤åˆ°æ“ä½œå‰çŠ¶æ€
4. **æ•°æ®éªŒè¯**ï¼šä¿å­˜å‰éªŒè¯æ•°æ®å®Œæ•´æ€§
5. **é”™è¯¯éš”ç¦»**ï¼šå•ç»„å¤±è´¥ä¸å½±å“å…¶ä»–ç»„

### ğŸ”§ æ ¸å¿ƒç‰¹æ€§

#### åˆ†ç»„ç­–ç•¥
- **é»˜è®¤åˆ†ç»„**ï¼šæ¯ç»„ 5 ä¸ªé¡¹ç›®
- **å¯é…ç½®åˆ†ç»„**ï¼š1-100 ä¸ªé¡¹ç›®è‡ªå®šä¹‰
- **æ™ºèƒ½åˆ†ç»„**ï¼šæ ¹æ®æ•°æ®é‡è‡ªåŠ¨è°ƒæ•´

#### æˆåŠŸç‡æ§åˆ¶
- **é»˜è®¤é˜ˆå€¼**ï¼š100% æˆåŠŸç‡è¦æ±‚
- **å¯é…ç½®é˜ˆå€¼**ï¼š50%-100% çµæ´»è®¾ç½®
- **è‡ªåŠ¨å›é€€**ï¼šä½äºé˜ˆå€¼è‡ªåŠ¨å›é€€

#### è¯¦ç»†æŠ¥å‘Š
- **ç»„çº§ç»Ÿè®¡**ï¼šæ¯ç»„çš„å¤„ç†ç»“æœ
- **é¡¹ç›®çº§ç»Ÿè®¡**ï¼šæ¯ä¸ªé¡¹ç›®çš„æˆåŠŸ/å¤±è´¥çŠ¶æ€
- **æ—¶é—´ç»Ÿè®¡**ï¼šæ“ä½œè€—æ—¶å’Œæ€§èƒ½åˆ†æ
- **é”™è¯¯åˆ†æ**ï¼šè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œå»ºè®®

### å¿«é€Ÿä½¿ç”¨ç¤ºä¾‹

#### åŸºç¡€æ‰¹é‡æ“ä½œ
```python
from manage_tdx_mark import SafeBatchService

# åˆ›å»ºæœåŠ¡
service = SafeBatchService()

# å‡†å¤‡æ•°æ®
updates = {
    "600613": "ä¸œé˜¿é˜¿èƒ¶-ä¼˜è´¨æ¶ˆè´¹è‚¡",
    "000001": "å¹³å®‰é“¶è¡Œ-é‡‘èé¾™å¤´",
    "002415": "æµ·åº·å¨è§†-å®‰é˜²é¾™å¤´"
}

# æ‰¹é‡æ›´æ–°ï¼ˆæ¨èï¼šå¤‡æ³¨åŒºå—ï¼‰
result = service.batch_update_tip(updates)

# æ£€æŸ¥ç»“æœ
if result.overall_success_rate == 100:
    print("âœ… æ‰€æœ‰æ•°æ®æ›´æ–°æˆåŠŸï¼")
    print(f"ğŸ“Š å¤„ç†äº† {result.total_successful_items} ä¸ªé¡¹ç›®")
else:
    print(f"âš ï¸ æˆåŠŸç‡ï¼š{result.overall_success_rate:.1f}%")
    print(f"âŒ å¤±è´¥é¡¹ç›®ï¼š{result.failed_items}")
```

#### è‡ªå®šä¹‰é…ç½®
```python
from manage_tdx_mark import SafeBatchService, create_safe_batch_config

# åˆ›å»ºè‡ªå®šä¹‰é…ç½®
config = create_safe_batch_config(
    chunk_size=10,               # æ¯ç»„å¤„ç†10ä¸ªé¡¹ç›®
    success_threshold=100.0,     # è¦æ±‚100%æˆåŠŸç‡
    auto_rollback=True,          # è‡ªåŠ¨å›é€€å¤±è´¥çš„ç»„
    continue_on_failure=True     # æŸç»„å¤±è´¥æ—¶ç»§ç»­å¤„ç†åç»­ç»„
)

# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®
service = SafeBatchService()
result = service.batch_update_tip(updates, config)
```

#### æ‰€æœ‰åŒºå—æ‰¹é‡æ“ä½œ
```python
from manage_tdx_mark import SafeBatchService

service = SafeBatchService()

# è‚¡ç¥¨ä»£ç åˆ—è¡¨
stocks = ["600613", "000001", "002415"]

# 1. æ‰¹é‡è®¾ç½®å…³æ³¨åº¦
marks = {stock: "9" for stock in stocks}
result1 = service.batch_update_mark(marks)

# 2. æ‰¹é‡è®¾ç½®å¤‡æ³¨
tips = {
    "600613": "ä¸œé˜¿é˜¿èƒ¶-æ¶ˆè´¹è‚¡",
    "000001": "å¹³å®‰é“¶è¡Œ-é‡‘èè‚¡",
    "002415": "æµ·åº·å¨è§†-ç§‘æŠ€è‚¡"
}
result2 = service.batch_update_tip(tips)

# 3. æ‰¹é‡è®¾ç½®æ ‡ç­¾
tipwords = {
    "600613": "æ¶ˆè´¹/ç™½é©¬",
    "000001": "é‡‘è/è“ç­¹",
    "002415": "ç§‘æŠ€/é¾™å¤´"
}
result3 = service.batch_update_tipword(tipwords)

# 4. æ‰¹é‡è®¾ç½®é¢œè‰²
tipcolors = {stock: "çº¢è‰²" for stock in stocks}
result4 = service.batch_update_tipcolor(tipcolors)

# 5. æ‰¹é‡è®¾ç½®æ—¶é—´
import datetime
current_time = datetime.datetime.now().strftime("%Y-%m-%d")
times = {stock: current_time for stock in stocks}
result5 = service.batch_update_time(times)

print("ğŸ“Š å¤šåŒºå—æ‰¹é‡æ“ä½œå®Œæˆ:")
print(f"  å…³æ³¨åº¦: {result1.overall_success_rate:.1f}%")
print(f"  å¤‡æ³¨: {result2.overall_success_rate:.1f}%")
print(f"  æ ‡ç­¾: {result3.overall_success_rate:.1f}%")
print(f"  é¢œè‰²: {result4.overall_success_rate:.1f}%")
print(f"  æ—¶é—´: {result5.overall_success_rate:.1f}%")
```

### å¤§æ‰¹é‡æ•°æ®å¤„ç†
```python
from manage_tdx_mark import SafeBatchService, create_safe_batch_config

# 1000åªè‚¡ç¥¨çš„æ‰¹é‡å¤„ç†
def process_large_dataset():
    service = SafeBatchService()
    
    # ç”Ÿæˆ1000åªè‚¡ç¥¨æ•°æ®
    large_updates = {
        f"60{i:04d}": f"è‚¡ç¥¨{i}å¤‡æ³¨" for i in range(1000)
    }
    
    # é…ç½®ï¼šé€‚åˆå¤§æ‰¹é‡çš„å‚æ•°
    config = create_safe_batch_config(
        chunk_size=20,               # æ¯ç»„20åªè‚¡ç¥¨
        success_threshold=98.0,      # 98%æˆåŠŸç‡å¯æ¥å—
        auto_rollback=True,          # è‡ªåŠ¨å›é€€
        continue_on_failure=True     # ç»§ç»­å¤„ç†
    )
    
    print(f"ğŸš€ å¼€å§‹å¤„ç† {len(large_updates)} åªè‚¡ç¥¨...")
    result = service.batch_update_tip(large_updates, config)
    
    print(f"ğŸ“Š å¤„ç†å®Œæˆ:")
    print(f"  æ€»æ•°æ®: {result.total_items}")
    print(f"  æ€»ç»„æ•°: {result.total_chunks}")
    print(f"  æˆåŠŸç»„: {result.successful_chunks}")
    print(f"  å¤±è´¥ç»„: {result.failed_chunks}")
    print(f"  å›é€€ç»„: {result.rolled_back_chunks}")
    print(f"  æˆåŠŸç‡: {result.overall_success_rate:.1f}%")
    print(f"  è€—æ—¶: {result.duration:.2f} ç§’")

# æ‰§è¡Œå¤§æ‰¹é‡å¤„ç†
process_large_dataset()
```

---

## ğŸ“ˆ æ ¸å¿ƒæ¦‚å¿µ

### 1. ğŸ“ mark.dat æ–‡ä»¶ç»“æ„
é€šè¾¾ä¿¡çš„æ ‡è®°æ–‡ä»¶åŒ…å« 5 ä¸ªæ•°æ®åŒºå—ï¼š

| åŒºå—å | ä½œç”¨ | ç¤ºä¾‹ |
|--------|------|------|
| **MARK** | è‚¡ç¥¨å…³æ³¨åº¦ç­‰çº§ | "8" (1-9çº§) |
| **TIP** | è‚¡ç¥¨å¤‡æ³¨è¯´æ˜ | "ä¼˜è´¨ç™½é©¬è‚¡" |
| **TIPWORD** | è‚¡ç¥¨æ ‡ç­¾ | "æ¶ˆè´¹/åŒ»è¯/ç™½é©¬" |
| **TIPCOLOR** | æ˜¾ç¤ºé¢œè‰² | "çº¢è‰²/ç»¿è‰²" |
| **TIME** | æ—¶é—´æˆ³ | "2024-01-01" |

### 2. ğŸ·ï¸ è‚¡ç¥¨ä»£ç æ ¼å¼
- **6ä½ä»£ç **ï¼š`600613` (ç”¨æˆ·å¸¸ç”¨)
- **8ä½ä»£ç **ï¼š`01600613` (ç³»ç»Ÿå†…éƒ¨æ ¼å¼)
  - `01` = ä¸Šæµ·è¯åˆ¸äº¤æ˜“æ‰€
  - `00` = æ·±åœ³è¯åˆ¸äº¤æ˜“æ‰€
  - `02` = åŒ—äº¬è¯åˆ¸äº¤æ˜“æ‰€

### 3. ğŸ”„ æ•°æ®æ“ä½œç­–ç•¥
- **ç›´æ¥æ›¿æ¢**ï¼šMARKã€TIPã€TIPCOLORã€TIME åŒºå—
- **åˆå¹¶ç­–ç•¥**ï¼šTIPWORD åŒºå—ä½¿ç”¨ "/" åˆ†éš”ç¬¦åˆå¹¶å¤šä¸ªæ ‡ç­¾

---

## ğŸ› ï¸ ä½¿ç”¨æ–¹å¼åˆ†å±‚æŒ‡å—

### ğŸ¥‡ ç¬¬ä¸€å±‚ï¼šå®‰å…¨æ‰¹é‡æ“ä½œ (â­ å¼ºçƒˆæ¨è)
**é€‚åˆï¼šæ‰¹é‡å¤„ç†ï¼Œè¿½æ±‚æ•°æ®å®‰å…¨**

```python
from manage_tdx_mark import SafeBatchService

# åˆ›å»ºå®‰å…¨æ‰¹é‡æœåŠ¡
service = SafeBatchService()

# æ‰¹é‡æ›´æ–°è‚¡ç¥¨å¤‡æ³¨
updates = {
    "600613": "ä¸œé˜¿é˜¿èƒ¶-ä¼˜è´¨æ¶ˆè´¹è‚¡",
    "000001": "å¹³å®‰é“¶è¡Œ-é‡‘èé¾™å¤´", 
    "002415": "æµ·åº·å¨è§†-å®‰é˜²é¾™å¤´"
}

result = service.batch_update_tip(updates)
if result.overall_success_rate == 100:
    print("âœ… æ‰€æœ‰æ•°æ®æ›´æ–°æˆåŠŸï¼")
else:
    print(f"âš ï¸ éƒ¨åˆ†æ›´æ–°æˆåŠŸï¼ŒæˆåŠŸç‡ï¼š{result.overall_success_rate:.1f}%")
```

**ç‰¹ç‚¹ï¼š**
- âœ… ğŸ›¡ï¸ æœ€å®‰å…¨ï¼šåˆ†ç»„å¤„ç†ï¼Œè‡ªåŠ¨å›é€€
- âœ… ğŸ“¦ æœ€é«˜æ•ˆï¼šé€‚åˆå¤§æ‰¹é‡æ•°æ®å¤„ç†
- âœ… ğŸ’¯ 100%ä¿éšœï¼šåªæœ‰å®Œå…¨æˆåŠŸæ‰ä¿å­˜
- âœ… ğŸ“Š è¯¦ç»†æŠ¥å‘Šï¼šå®Œæ•´çš„æ“ä½œç»Ÿè®¡

### ğŸ¥ˆ ç¬¬äºŒå±‚ï¼šåŸºç¡€ä½¿ç”¨ (å‘åå…¼å®¹)
**é€‚åˆï¼šç¼–ç¨‹æ–°æ‰‹ï¼Œå¿«é€Ÿä¸Šæ‰‹**

```python
from manage_tdx_mark import TdxMarkManager

# åˆ›å»ºç®¡ç†å™¨
manager = TdxMarkManager()

# åŸºæœ¬æ“ä½œ
data = manager.load_data()                    # åŠ è½½æ•°æ®
manager.update_stock_mark("600613", "8")     # æ›´æ–°æ ‡è®°
manager.update_stock_tip("600613", "ä¼˜è´¨è‚¡")  # æ›´æ–°å¤‡æ³¨
manager.save_data(data)                       # ä¿å­˜æ•°æ®
```

**ç‰¹ç‚¹ï¼š**
- âœ… ç®€å•æ˜“æ‡‚ï¼Œä¸€ç›®äº†ç„¶
- âœ… å®Œå…¨å‘åå…¼å®¹
- âœ… é€‚åˆå•ä¸ªè‚¡ç¥¨æ“ä½œ
- âŒ æ‰¹é‡æ“ä½œå®‰å…¨æ€§è¾ƒä½

### ğŸ¥‰ ç¬¬ä¸‰å±‚ï¼šæœåŠ¡å±‚ä½¿ç”¨ (é«˜çº§)
**é€‚åˆï¼šæœ‰ä¸€å®šç¼–ç¨‹åŸºç¡€ï¼Œè¿½æ±‚ä»£ç è´¨é‡**

```python
from manage_tdx_mark import DataOperationService, StockInfo

# åˆ›å»ºæœåŠ¡
service = DataOperationService()

# åˆ›å»ºè‚¡ç¥¨ä¿¡æ¯å¯¹è±¡
stock = StockInfo(
    stock_code="600613",
    full_code="01600613", 
    market="ä¸Šäº¤æ‰€",
    mark="8",
    tip="ä¸œé˜¿é˜¿èƒ¶ - ä¼˜è´¨æ¶ˆè´¹è‚¡",
    tipword="æ¶ˆè´¹/åŒ»è¯/ä¼ ç»Ÿ"
)

# æ·»åŠ è‚¡ç¥¨æ•°æ®
result = service.add_stock_data(stock, data)
if result.success:
    print(f"æˆåŠŸæ·»åŠ ï¼Œå½±å“è®°å½•ï¼š{result.affected_records}")
```

**ç‰¹ç‚¹ï¼š**
- âœ… ç±»å‹å®‰å…¨ï¼ŒIDE å‹å¥½
- âœ… è¯¦ç»†çš„æ“ä½œç»“æœåé¦ˆ
- âœ… é€‚åˆç²¾ç»†åŒ–æ§åˆ¶
- âŒ æ‰¹é‡æ“ä½œéœ€è¦é¢å¤–å¤„ç†

---

## ğŸ“ å®æˆ˜ç¤ºä¾‹

### ğŸ¯ åœºæ™¯1ï¼šæ‰¹é‡è®¾ç½®ç™½é©¬è‚¡æ ‡ç­¾ï¼ˆâ­ æ¨èæ–¹å¼ï¼‰
```python
from manage_tdx_mark import SafeBatchService

service = SafeBatchService()

# ç™½é©¬è‚¡æ‰¹é‡æ ‡ç­¾è®¾ç½®
white_horse_stocks = {
    "600613": "æ¶ˆè´¹/åŒ»è¯/ç™½é©¬",
    "000858": "æ¶ˆè´¹/ç™½é…’/ç™½é©¬", 
    "000001": "é‡‘è/é“¶è¡Œ/ç™½é©¬",
    "600036": "é‡‘è/é“¶è¡Œ/ç™½é©¬",
    "002415": "ç§‘æŠ€/å®‰é˜²/ç™½é©¬"
}

# å®‰å…¨æ‰¹é‡æ›´æ–°ï¼ˆè‡ªåŠ¨åˆ†ç»„ã€å¤±è´¥å›é€€ï¼‰
result = service.batch_update_tipword(white_horse_stocks)
print(f"âœ… ç™½é©¬è‚¡æ ‡ç­¾è®¾ç½®å®Œæˆï¼ŒæˆåŠŸç‡ï¼š{result.overall_success_rate:.1f}%")
print(f"ğŸ“Š æˆåŠŸå¤„ç†ï¼š{result.total_successful_items}/{result.total_items}")

# å¦‚æœæœ‰å¤±è´¥é¡¹ç›®
if result.failed_items:
    print("âŒ å¤±è´¥é¡¹ç›®ï¼š", result.failed_items)
```

### ğŸ¯ åœºæ™¯2ï¼šå¤§æ‰¹é‡è‚¡ç¥¨æ ‡è®°è®¾ç½®
```python
from manage_tdx_mark import SafeBatchService, create_safe_batch_config

service = SafeBatchService()

# 100åªè‚¡ç¥¨çš„å…³æ³¨åº¦è®¾ç½®
large_updates = {
    f"60{i:04d}": "8" for i in range(100)  # 600000-600099ï¼Œå…³æ³¨åº¦è®¾ä¸º8
}

# é…ç½®ï¼šå°ç»„å¤„ç†ï¼Œç¡®ä¿å®‰å…¨
config = create_safe_batch_config(
    chunk_size=10,              # æ¯ç»„10åªè‚¡ç¥¨
    success_threshold=100.0,    # 100%æˆåŠŸç‡
    auto_rollback=True,         # è‡ªåŠ¨å›é€€
    continue_on_failure=True    # ç»§ç»­å¤„ç†åç»­ç»„
)

result = service.batch_update_mark(large_updates, config)
print(f"ğŸ¯ å¤§æ‰¹é‡å¤„ç†å®Œæˆï¼š")
print(f"  æ€»ç»„æ•°ï¼š{result.total_chunks}")
print(f"  æˆåŠŸç»„ï¼š{result.successful_chunks}")
print(f"  å›é€€ç»„ï¼š{result.rolled_back_chunks}")
print(f"  æ€»ä½“æˆåŠŸç‡ï¼š{result.overall_success_rate:.1f}%")
```

### ğŸ¯ åœºæ™¯3ï¼šç»™å•ä¸ªè‚¡ç¥¨æ‰“æ ‡è®°ï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰
```python
from manage_tdx_mark import TdxMarkManager

manager = TdxMarkManager()
data = manager.load_data()

# è®¾ç½®ä¸œé˜¿é˜¿èƒ¶ä¸ºé«˜å…³æ³¨åº¦
manager.update_stock_mark("600613", "9")
manager.update_stock_tip("600613", "ä¼˜è´¨ç™½é©¬è‚¡ï¼Œå€¼å¾—é•¿æœŸå…³æ³¨")

manager.save_data(data)
print("âœ… è‚¡ç¥¨æ ‡è®°è®¾ç½®å®Œæˆ")
```

### ğŸ¯ åœºæ™¯4ï¼šå¤šåŒºå—åŒæ—¶æ‰¹é‡æ›´æ–°
```python
from manage_tdx_mark import SafeBatchService

service = SafeBatchService()

# åŒä¸€æ‰¹è‚¡ç¥¨çš„å¤šåŒºå—æ•°æ®
stock_codes = ["600613", "000001", "002415"]

# æ‰¹é‡è®¾ç½®æ ‡è®°
marks = {code: "9" for code in stock_codes}
result1 = service.batch_update_mark(marks)

# æ‰¹é‡è®¾ç½®å¤‡æ³¨
tips = {
    "600613": "ä¸œé˜¿é˜¿èƒ¶-æ¶ˆè´¹é¾™å¤´",
    "000001": "å¹³å®‰é“¶è¡Œ-é‡‘èé¾™å¤´",
    "002415": "æµ·åº·å¨è§†-å®‰é˜²é¾™å¤´"
}
result2 = service.batch_update_tip(tips)

# æ‰¹é‡è®¾ç½®æ ‡ç­¾
tipwords = {
    "600613": "æ¶ˆè´¹/åŒ»è¯/ç™½é©¬",
    "000001": "é‡‘è/é“¶è¡Œ/è“ç­¹",
    "002415": "ç§‘æŠ€/å®‰é˜²/é¾™å¤´"
}
result3 = service.batch_update_tipword(tipwords)

print("ğŸ“Š å¤šåŒºå—æ‰¹é‡æ›´æ–°å®Œæˆï¼š")
print(f"  æ ‡è®°æˆåŠŸç‡ï¼š{result1.overall_success_rate:.1f}%")
print(f"  å¤‡æ³¨æˆåŠŸç‡ï¼š{result2.overall_success_rate:.1f}%")
print(f"  æ ‡ç­¾æˆåŠŸç‡ï¼š{result3.overall_success_rate:.1f}%")
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

- **ğŸ›¡ï¸ å®‰å…¨æ‰¹é‡æ“ä½œ**ï¼šåˆ†ç»„å¤„ç†é™ä½é£é™©ï¼Œè‡ªåŠ¨å›é€€ä¿éšœæ•°æ®å®‰å…¨
- **æ™ºèƒ½ç¼“å­˜**ï¼šLRUç¼“å­˜å‡å°‘é‡å¤æ–‡ä»¶I/O
- **æ‰¹é‡æ“ä½œ**ï¼šæ”¯æŒæ‰¹é‡æ›´æ–°ï¼Œæå‡å¤§æ•°æ®å¤„ç†æ•ˆç‡
- **å†…å­˜ä¼˜åŒ–**ï¼šä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼Œæ”¯æŒå¤§æ–‡ä»¶å¤„ç†
- **å¹¶å‘å®‰å…¨**ï¼šçº¿ç¨‹å®‰å…¨çš„æ“ä½œï¼Œæ”¯æŒå¹¶å‘è®¿é—®

---

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- **ğŸ›¡ï¸ åˆ†ç»„æ‰¹é‡å¤„ç†**ï¼šè‡ªåŠ¨åˆ†ç»„ï¼Œå•ç»„å¤±è´¥ä¸å½±å“å…¶ä»–ç»„
- **ğŸ’¾ è‡ªåŠ¨å¤‡ä»½å›é€€**ï¼šæ¯ç»„æ“ä½œå‰å¤‡ä»½ï¼Œå¤±è´¥æ—¶è‡ªåŠ¨å›é€€
- **âœ… 100%æˆåŠŸç‡è¦æ±‚**ï¼šåªæœ‰å®Œå…¨æˆåŠŸçš„ç»„æ‰ä¼šä¿å­˜
- **è·¯å¾„éªŒè¯**ï¼šé˜²æ­¢è·¯å¾„éå†æ”»å‡»
- **è¾“å…¥å‡€åŒ–**ï¼šè‡ªåŠ¨æ¸…ç†å’ŒéªŒè¯ç”¨æˆ·è¾“å…¥
- **æƒé™æ£€æŸ¥**ï¼šæ–‡ä»¶æ“ä½œå‰çš„æƒé™éªŒè¯
- **æ•°æ®æ ¡éªŒ**ï¼šä¸¥æ ¼çš„æ•°æ®æ ¼å¼éªŒè¯

---

## â“ å¸¸è§é—®é¢˜è§£ç­”

### Q1: ä¸ºä»€ä¹ˆæ¨èä½¿ç”¨ SafeBatchServiceï¼Ÿ
**A:** SafeBatchService æ˜¯æœ€å®‰å…¨çš„æ‰¹é‡æ“ä½œæ–¹å¼ï¼š
- ğŸ›¡ï¸ **è‡ªåŠ¨åˆ†ç»„**ï¼šå¤§æ‰¹é‡æ•°æ®åˆ†æˆå°ç»„å¤„ç†ï¼Œé™ä½é£é™©
- ğŸ’¾ **è‡ªåŠ¨å¤‡ä»½**ï¼šæ¯ç»„æ“ä½œå‰åˆ›å»ºå¤‡ä»½
- ğŸ”„ **æ™ºèƒ½å›é€€**ï¼šå¤±è´¥æ—¶è‡ªåŠ¨æ¢å¤ï¼Œä¸ä¼šä¸¢å¤±æ•°æ®
- ğŸ’¯ **100%ä¿éšœ**ï¼šåªæœ‰å®Œå…¨æˆåŠŸçš„ç»„æ‰ä¼šä¿å­˜

### Q2: SafeBatchService å’Œæ™®é€šæ‰¹é‡æ“ä½œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
**A:** ä¸»è¦åŒºåˆ«åœ¨å®‰å…¨æ€§å’Œå¯é æ€§ï¼š

| ç‰¹æ€§ | SafeBatchService | æ™®é€šæ‰¹é‡æ“ä½œ |
|------|------------------|-------------|
| åˆ†ç»„å¤„ç† | âœ… è‡ªåŠ¨åˆ†ç»„ | âŒ å…¨é‡å¤„ç† |
| å¤±è´¥å›é€€ | âœ… è‡ªåŠ¨å›é€€ | âŒ æ— å›é€€ |
| æˆåŠŸç‡ä¿éšœ | âœ… 100%è¦æ±‚ | âŒ éƒ¨åˆ†æˆåŠŸå³ä¿å­˜ |
| è¯¦ç»†æŠ¥å‘Š | âœ… å®Œæ•´ç»Ÿè®¡ | âŒ åŸºç¡€ç»“æœ |

### Q3: å¦‚ä½•å¤„ç†å¤§æ‰¹é‡æ•°æ®ï¼ˆ1000+è‚¡ç¥¨ï¼‰ï¼Ÿ
**A:** ä½¿ç”¨ SafeBatchService çš„è‡ªå®šä¹‰é…ç½®ï¼š
```python
config = create_safe_batch_config(
    chunk_size=20,              # æ¯ç»„20åªè‚¡ç¥¨
    success_threshold=100.0,    # 100%æˆåŠŸç‡
    continue_on_failure=True    # å¤±è´¥ç»„ä¸å½±å“åç»­ç»„
)
```

### Q4: æ‰¹é‡æ“ä½œå¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿ
**A:** SafeBatchService æä¾›å¤šé‡ä¿éšœï¼š
- **è‡ªåŠ¨å›é€€**ï¼šå¤±è´¥çš„ç»„ä¼šè‡ªåŠ¨æ¢å¤
- **è¯¦ç»†æŠ¥å‘Š**ï¼šæŸ¥çœ‹ `result.failed_items` äº†è§£å¤±è´¥åŸå› 
- **ç»§ç»­å¤„ç†**ï¼šå¤±è´¥ç»„ä¸å½±å“å…¶ä»–ç»„çš„å¤„ç†
- **æ‰‹åŠ¨ä¿®å¤**ï¼šæ ¹æ®é”™è¯¯ä¿¡æ¯æ‰‹åŠ¨ä¿®å¤é—®é¢˜æ•°æ®

### Q5: ä¸ºä»€ä¹ˆæœ‰äº›åŠŸèƒ½è¦ç”¨ 8 ä½è‚¡ç¥¨ä»£ç ï¼Ÿ
**A:** é€šè¾¾ä¿¡å†…éƒ¨ä½¿ç”¨ 8 ä½ä»£ç åŒºåˆ†ä¸åŒäº¤æ˜“æ‰€ï¼š
- `01600613` = ä¸Šäº¤æ‰€çš„ 600613
- `00000001` = æ·±äº¤æ‰€çš„ 000001  
- å·¥å…·ä¼šè‡ªåŠ¨è½¬æ¢ï¼Œä½ é€šå¸¸åªéœ€è¦è¾“å…¥ 6 ä½ä»£ç 

### Q6: TIPWORD æ ‡ç­¾ä¸ºä»€ä¹ˆç”¨ "/" åˆ†éš”ï¼Ÿ
**A:** è¿™æ˜¯é€šè¾¾ä¿¡çš„æ ‡å‡†æ ¼å¼ï¼Œå…è®¸ä¸€ä¸ªè‚¡ç¥¨æœ‰å¤šä¸ªæ ‡ç­¾ï¼š
- `"æ¶ˆè´¹"` â†’ å•ä¸ªæ ‡ç­¾
- `"æ¶ˆè´¹/ç™½é©¬"` â†’ ä¸¤ä¸ªæ ‡ç­¾
- `"æ¶ˆè´¹/ç™½é©¬/åŒ»è¯"` â†’ ä¸‰ä¸ªæ ‡ç­¾

---

## ğŸš€ å­¦ä¹ è·¯å¾„å»ºè®®

### é˜¶æ®µä¸€ï¼šå…¥é—¨ (1-2å‘¨)
**ç›®æ ‡ï¼šæŒæ¡å®‰å…¨æ‰¹é‡æ“ä½œ**

1. **å®‰è£…å’Œé…ç½®**
   ```bash
   pip install manage_tdx_mark
   ```

2. **å­¦ä¹  SafeBatchService**
   - åŸºæœ¬æ‰¹é‡æ›´æ–°
   - æŸ¥çœ‹æ“ä½œç»“æœ
   - ç†è§£æˆåŠŸç‡æ¦‚å¿µ

3. **å®è·µé¡¹ç›®**
   - ç»™è‡ªå·±å…³æ³¨çš„ 10 åªè‚¡ç¥¨æ‰¹é‡æ‰“æ ‡è®°
   - è®¾ç½®è¡Œä¸šæ ‡ç­¾

### é˜¶æ®µäºŒï¼šè¿›é˜¶ (2-3å‘¨)  
**ç›®æ ‡ï¼šæŒæ¡è‡ªå®šä¹‰é…ç½®å’Œå¤šåŒºå—æ“ä½œ**

1. **å­¦ä¹ é…ç½®é€‰é¡¹**
   - è°ƒæ•´åˆ†ç»„å¤§å°
   - è®¾ç½®æˆåŠŸç‡é˜ˆå€¼
   - æ§åˆ¶é”™è¯¯å¤„ç†ç­–ç•¥

2. **æŒæ¡å¤šåŒºå—æ“ä½œ**
   - åŒæ—¶æ›´æ–°æ ‡è®°ã€å¤‡æ³¨ã€æ ‡ç­¾
   - ç†è§£ä¸åŒåŒºå—çš„ç‰¹ç‚¹

3. **å®è·µé¡¹ç›®**
   - åˆ›å»ºå®Œæ•´çš„æŠ•èµ„ç»„åˆç®¡ç†ç³»ç»Ÿ
   - æ‰¹é‡å¯¼å…¥å’Œå¤„ç†è‚¡ç¥¨æ± æ•°æ®

### é˜¶æ®µä¸‰ï¼šé«˜çº§ (3-4å‘¨)
**ç›®æ ‡ï¼šç²¾é€šæ‰€æœ‰åŠŸèƒ½ï¼Œç†è§£åº•å±‚åŸç†**

1. **æ·±å…¥ç†è§£æ¶æ„**
   - å­¦ä¹ ä¼ ç»Ÿ API
   - ç†è§£æ•°æ®æ¨¡å‹
   - æŒæ¡ç¼“å­˜æœºåˆ¶

2. **æ€§èƒ½ä¼˜åŒ–**
   - å¤§æ‰¹é‡æ•°æ®å¤„ç†
   - è‡ªå®šä¹‰éªŒè¯è§„åˆ™

3. **å®è·µé¡¹ç›®**
   - æ„å»ºä¼ä¸šçº§è‚¡ç¥¨ç®¡ç†ç³»ç»Ÿ
   - æ•°æ®åˆ†æå’ŒæŠ¥å‘Šç”Ÿæˆ

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v3.1.0 (å½“å‰ç‰ˆæœ¬)
- â­ **SafeBatchService**ï¼šå…¨æ–°å®‰å…¨æ‰¹é‡æ“ä½œæœåŠ¡
- ğŸ›¡ï¸ åˆ†ç»„å°æ‰¹é‡å¤„ç†ï¼Œ100%æˆåŠŸç‡ä¿éšœ
- ğŸ’¾ è‡ªåŠ¨å¤‡ä»½å›é€€æœºåˆ¶
- âœ¨ å…¨æ–°æ¨¡å—åŒ–æ¶æ„
- ğŸ”’ å¢å¼ºå®‰å…¨éªŒè¯
- âš¡ æ™ºèƒ½ç¼“å­˜ç³»ç»Ÿ
- ğŸ“Š ç±»å‹å®‰å…¨ä¿è¯

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº MIT è®¸å¯è¯å¼€æº - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

---

## ğŸ‘¨â€ğŸ’» ä½œè€…

**Kilo Code**
- ğŸ“§ Email: kilocode@example.com
- ğŸ¢ ä¸“æ³¨äºé‡‘èç§‘æŠ€å’ŒæŠ•èµ„å·¥å…·å¼€å‘

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰ä¸ºè¿™ä¸ªé¡¹ç›®åšå‡ºè´¡çŒ®çš„å¼€å‘è€…å’Œç”¨æˆ·ã€‚

---

## ğŸ‰ æ€»ç»“

TDX Mark Manager ç°åœ¨æœ‰äº†**æœ€å®‰å…¨çš„æ‰¹é‡æ“ä½œæ–¹æ¡ˆ**ï¼š

- **ğŸ¥‡ SafeBatchService**ï¼šæœ€æ¨èï¼Œæœ€å®‰å…¨ï¼Œé€‚åˆæ‰¹é‡å¤„ç†
- **ğŸ¥ˆ åŸºç¡€ API**ï¼šç®€å•æ˜“ç”¨ï¼Œé€‚åˆå•ä¸ªæ“ä½œ  
- **ğŸ¥‰ æœåŠ¡å±‚ API**ï¼šçµæ´»æ§åˆ¶ï¼Œé€‚åˆé«˜çº§ç”¨æˆ·

**æ ¸å¿ƒä¼˜åŠ¿ï¼š**
- ğŸ›¡ï¸ **åˆ†ç»„å¤„ç†**ï¼šé™ä½é£é™©ï¼Œæé«˜æˆåŠŸç‡
- ğŸ’¾ **è‡ªåŠ¨å›é€€**ï¼šå¤±è´¥ä¸ä¸¢æ•°æ®
- ğŸ’¯ **100%ä¿éšœ**ï¼šåªä¿å­˜å®Œå…¨æˆåŠŸçš„æ•°æ®
- ğŸ“Š **è¯¦ç»†æŠ¥å‘Š**ï¼šæ¸…æ¥šäº†è§£æ¯ä¸ªæ“ä½œçš„ç»“æœ

**è®°ä½ï¼š**å¥½çš„å·¥å…·åº”è¯¥è®©å¤æ‚çš„äº‹æƒ…å˜ç®€å•ï¼Œè®©ç®€å•çš„äº‹æƒ…å˜è‡ªåŠ¨åŒ–ã€‚SafeBatchService è®©æ‰¹é‡æ“ä½œå˜å¾—æ—¢ç®€å•åˆå®‰å…¨ï¼

---

<div align="center">

**å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ª â­ Starï¼**

ğŸ“ **éœ€è¦å¸®åŠ©ï¼Ÿ**
- ğŸ“§ Email: kilocode@example.com
- ğŸ› é—®é¢˜åé¦ˆï¼š[GitHub Issues](https://github.com/your-repo/issues)
- ğŸ“š æ›´å¤šæ–‡æ¡£ï¼š[é¡¹ç›®ä¸»é¡µ](https://github.com/your-repo)

</div>